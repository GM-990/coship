#!/bin/bash
#
# This file is used for creating Makefile
#
#
#set -x

_FILEPATH=$MMCP_HOME/build/$MMCP_PLATFORM/COption.rules

BlankLine()
{
  echo ' ' >> $_FILEPATH
}
GenerateCommentLine()
{
  echo '###############################################' >> $_FILEPATH
  echo "####  MODULE NAMEs : $1 " >> $_FILEPATH 
  echo '###############################################' >> $_FILEPATH
}
GenerateFileStart()
{
  echo '################################################' > $_FILEPATH
  echo "###### start of compile option file ######" >> $_FILEPATH 
  echo '################################################' >> $_FILEPATH
}

GenerateFileEnd()
{
  echo '################################################' >> $_FILEPATH
  echo "###### end of compile option file ########" >> $_FILEPATH 
  echo '################################################' >> $_FILEPATH
}

GenerateContent() 
{
	NULLSTING=

	GenerateFileStart

	BlankLine
	echo "MODULE_MMCP_GRAPHICS					:= $MODULE_MMCP_GRAPHICS" >> $_FILEPATH
	echo "MODULE_MMCP_DTV						:= $MODULE_MMCP_DTV" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL					:= $MODULE_MMCP_KERNEL" >> $_FILEPATH
	echo "MODULE_MMCP_MEDIAPLAYER				:= $MODULE_MMCP_MEDIAPLAYER" >> $_FILEPATH
	echo "MODULE_MMCP_PROTOCOL					:= $MODULE_MMCP_PROTOCOL" >> $_FILEPATH
	echo "MODULE_MMCP_PVR						:= $MODULE_MMCP_PVR" >> $_FILEPATH
	echo "MODULE_MMCP_GUITOOL					:= $MODULE_MMCP_GUITOOL" >> $_FILEPATH
	echo "MODULE_MMCP_PORTING_SHARE			:= $MODULE_MMCP_PORTING_SHARE" >> $_FILEPATH
	echo "MODULE_MMCP_PORTING_PLATFORM		:= $MODULE_MMCP_PORTING_PLATFORM" >> $_FILEPATH
	echo "MODULE_MMCP_JVM						:= $MODULE_MMCP_JVM" >> $_FILEPATH
	echo "MODULE_MMCP_CLASSES					:= $MODULE_MMCP_CLASSES" >> $_FILEPATH
	echo "MODULE_MMCP_DTVM						:= $MODULE_MMCP_DTVM" >> $_FILEPATH
	echo "MODULE_MMCP_MHP						:= $MODULE_MMCP_MHP" >> $_FILEPATH

	### M1:	GRAPHICS MODULES	###
	BlankLine
	GenerateCommentLine "GRAPHICS"
	NULLSTRING="$MODULE_MMCP_GRAPHICS"
	echo "MODULE_MMCP_GRAPHICS_GUI			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_GRAPHICS_FONT			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_GRAPHICS_GIF			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_GRAPHICS_JPG			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_GRAPHICS_PNG			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_GRAPHICS_SMOOTH		:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_GRAPHICS_IMAGE			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_GRAPHICS_FREETYPE		:= $NULLSTRING" >> $_FILEPATH

	### M2:	DTV MODULES	###
	BlankLine
	GenerateCommentLine "DTV"
	NULLSTRING=$MODULE_MMCP_DTV
	echo "MODULE_MMCP_DTV_CRC					:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_DATAMANAGER		:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_EPG					:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_MEMORYPOOL			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_NVOD					:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_SEARCH				:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_SECTION				:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_SERVICEMANAGER	:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_SI					:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_SOFTDEMUX			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_SOURCE				:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_SUBTITLE			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_DTV_TELETEXT			:= $NULLSTRING" >> $_FILEPATH
#	echo "MODULE_MMCP_DTV_T9INPUT				:= $NULLSTRING" >> $_FILEPATH
#	echo "MODULE_MMCP_DTV_RMFS					:= $NULLSTRING" >> $_FILEPATH
#	echo "MODULE_MMCP_DTV_RAPS					:= $NULLSTRING" >> $_FILEPATH

	### M3:	KERNEL MODULES	###
	BlankLine
	GenerateCommentLine "KERNEL"
	NULLSTRING=$MODULE_MMCP_KERNEL
	echo "MODULE_MMCP_KERNEL_MEMORY			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_EVENT			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_UTILS			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_CFS				:= $NULLSTRING" >> $_FILEPATH

#
# CFS variable setting
#
	echo "MODULE_MMCP_KERNEL_CFS_JFFS := $MODULE_MMCP_KERNEL_CFS_JFFS" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_CFS_DEVICE := $MODULE_MMCP_KERNEL_CFS_DEVICE" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_CFS_FAT := $MODULE_MMCP_KERNEL_CFS_FAT" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_CFS_E2FS := $MODULE_MMCP_KERNEL_CFS_E2FS" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_CFS_OC	:= $MODULE_MMCP_KERNEL_CFS_OC" >> $_FILEPATH
	echo "MODULE_MMCP_KERNEL_CFS_ROM := $MODULE_MMCP_KERNEL_CFS_ROM" >> $_FILEPATH

### M4:	MEDIAPLAYER MODULES	   ##
	BlankLine
	GenerateCommentLine "MEDIAPLAYER"
	NULLSTRING=$MODULE_MMCP_MEDIAPLAYER
	echo "MODULE_MMCP_MEDIAPLAYER_PLAYER	:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_MEDIAPLAYER_FILEPUMP	:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_MEDIAPLAYER_IPPUMP	:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_MEDIAPLAYER_SELECTION:= $NULLSTRING" >> $_FILEPATH

	### M5:	PROTOCOL MODULES	   ##
	BlankLine
	GenerateCommentLine "PROTOCOL"
	NULLSTRING=$MODULE_MMCP_PROTOCOL
	echo "MODULE_MMCP_PROTOCOL_HTTP 			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_PROTOCOL_NTP			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_PROTOCOL_RTP			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_PROTOCOL_RTSP			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_PROTOCOL_SDP			:= $NULLSTRING" >> $_FILEPATH
	echo "MODULE_MMCP_PROTOCOL_SOAP			:= $NULLSTRING" >> $_FILEPATH

	### M8.1	PORTING MODULES_PORTING_SHARE	##
	BlankLine
	GenerateCommentLine "PORTING.SHARE"
	if [ "$MMCP_PLATFORM" != "linux" ]; then
		NULLSTRING=$MODULE_MMCP_PORTING_SHARE
		echo "MODULE_MMCP_PORTING_SHARE_HDICOMMON 		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_COFDM		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_EEPROM	:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_ENCODER	:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_FLASH		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_LCD		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_QAM		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_QPSK		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_RFMOD		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_SCART		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_VFD		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_IR			:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_PANEL		:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_SERIAL	:= FALSE" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_USB		:= FALSE" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_SHARE_HDICOM_LAN		:= FALSE" >> $_FILEPATH
	fi

	### M8.2	PORTING MODULES_PORTING_PLAFORM	##
	BlankLine
	GenerateCommentLine "PORTING.PLATFORM"		
	NULLSTRING=$MODULE_MMCP_PORTING_PLATFORM
	if [ "$MMCP_PLATFORM" = "linux" ]; then
		echo "MODULE_MMCP_PORTING_LINUX						:= $NULLSTRING" >> $_FILEPATH
	elif [ "$MMCP_PLATFORM" = "st5105" ]; then
		echo "MODULE_MMCP_PORTING_ST5105						:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_ST5105_STDRV				:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_ST5105_PFDRV				:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_ST5105_HDISPECIAL		:= $NULLSTRING" >> $_FILEPATH
	elif [ "$MMCP_PLATFORM" = "st7100" ]; then
		echo "MODULE_MMCP_PORTING_ST7100						:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_ST7100_STDRV				:= $NULLSTRING" >> $_FILEPATH
		echo "MODULE_MMCP_PORTING_ST7100_PFDRV				:= $NULLSTRING" >> $_FILEPATH
	elif [ "$MMCP_PLATFORM" = "bcm7401" ]; then
		echo "MODULE_MMCP_PORTING_BCM7401					:= $NULLSTRING" >> $_FILEPATH
	elif  [ "$MMCP_PLATFORM" = "bcm7309" ]; then
		echo "MODULE_MMCP_PORTING_BCM7309					:= $NULLSTRING" >> $_FILEPATH
	fi

	BlankLine	
	GenerateFileEnd
}

GenerateOptionFile()
{
	#if [ "`find . -maxdepth 1 -name '$_FILEPATH'`" ]; then	
	if [ -f $_FILEPATH ]; then

# If this file should be re-generated each time, then we should over write it
#		echo "$_FILEPATH exist already, please remove it before u generate new options."
		echo '$MMCP_HOME/build/'"$MMCP_PLATFORM/COption.rules exist already, it will be overrided with new options..."
		##echo "rm $_FILEPATH"
		##rm -rf $_FILEPATH
	fi
	echo "Generating $_FILEPATH, ..."
	GenerateContent
}

##################
# Main Functions #
##################

GenerateOptionFile
